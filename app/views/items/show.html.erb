
<div>
  <div class="row" style="margin-top: 50px; justify-content: center;">
    <div class="col-5" style="background: gray; height: 100vh; padding: 2rem;">

      <h5>Category: <%= @item.category %></h5>
      <% if @item.photos.first %>
        <% @item.photos.each do |photo| %>
          <%= cl_image_tag photo.key, height: 300, width: 400, crop: :fill %>
        <% end %>
      <% end %>

      <h4 style="margin-top: 20px;"><strong>Name: <%= @item.name %></strong></h4>
      <h4>Description: <%= @item.description %></h4>
      <h4>Price: $<%= number_with_precision(@item.price, precision: 2) %></h4>
      <h4>Seller: <%= @item.user.name %></h4>

      <hr>

      <% if @item.status != "sold" %>
        <% if @item.user != current_user && @item.offers.exists?(user: current_user)%>
          <%= simple_form_for [@item, @offer], html: { class: "offer-form" } do |f| %>
            <%= f.input :price %>
            <%= f.submit "Edit Offer"%>
          <% end %>
        <% elsif @item.user != current_user %>
          <%= simple_form_for [@item, Offer.new], html: { class: "offer-form" } do |f| %>
            <%= f.input :price %>
            <%= f.submit "New Offer"%>
          <% end %>
        <% end %>
      <% else %>
        <h1>Item has been sold!</h1>
      <% end %>

      <% if policy(@item).destroy? %>
        <%= link_to "Remove this item",
          item_path(@item), class: "btn btn-primary", method: :delete,
          data: {turbo_method: :delete, turbo_confirm: "Are you sure?"}
        %>
      <% end %>
      <hr>

    </div>

    <div class="col-7" style="background: gray; height: 100vh; padding: 2rem;">
      <div style="height: 100%; padding-right: 10px; overflow-y: scroll">

    <% if @item.user == current_user %>
      <h1>Offers you have received for this item</h1>

      <% @offers.each do |offer| %>
        <% if @item.status == "available" && offer.status != "Offer declined" %>

          <table class="table table-striped">
            <tr>
                <th>List Price</th>
                <th>Offered Price</th>
                <th>Offered By</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
            <div class="grid-container">
              <% @offers.each do |offer| %>
                <tr>
                    <td>$<%= number_with_precision(offer.item.price, precision: 2) %></td>
                    <td>$<%= number_with_precision(offer.price, precision: 2) %></td>
                    <td><%= offer.user.name %></td>
                    <td><%= offer.status %></td>
                    <td>
                      <%= link_to "Accept", offer_approve_path(offer), method: :post, data: {turbo_method: :post} %>
                      <%= link_to "Decline", offer_decline_path(offer), method: :post, data: {turbo_method: :post} %>
                    </td>

                </tr>
              <% end %>
            </div>
          </table>
        <% end %>
      <% end %>

        <hr>


    <% elsif @offers.any? { |offer| offer.user == current_user } %>
      <h1>Offers you have made for this item</h1>

      <% @offers.each do |offer| %>
        <% if offer.user == current_user  %>
          <p>Price you offered: $<%= number_with_precision(@item.price, precision: 2) %></p>
          <p>Item status : <%= @item.status %></p>
          <p>Offer status : <%= offer.status %></p>
        <% end %>
      <% end %>
    <% else %>
      <h1>You have not made any offer for this item</h1>
    <% end %>

  <br>

  <%= link_to "Back to my items", user_path(current_user), class: "btn btn-primary center-btn" %>

</div>
